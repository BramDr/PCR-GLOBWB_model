name: Black

on: [pull_request]

jobs:
  autopep8:
    # Check if the PR is not raised by this workflow and is not from a fork
    if: startsWith(github.head_ref, 'black-patches') == false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout branch
        uses: actions/checkout@v4
      - name: Run Black
        id: black
        uses: psf/black@stable
        with:
          args: "."
        continue-on-error: true
      - name: Set black-patches branch name
        id: vars
        run: |
          branch-name="black-patches/${{ github.head_ref }}"
          echo "branch-name=$branch-name" >> $GITHUB_OUTPUT
      - name: Run Create Pull Request
        if: steps.black.outputs.exit-code > 0
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: black fixes
          title: Fixes by black
          body: This is an auto-generated pull-request with fixes by black.
          labels: black
          branch: ${{ steps.vars.outputs.branch-name }}
      - name: Fail if black made changes
        if: steps.black.outputs.exit-code > 0
        run: exit 1